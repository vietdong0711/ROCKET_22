!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";function t(n,s){var o=function(){},i=this,l={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:t.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:o,onSearchComplete:o,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(t){return"string"==typeof t?e.parseJSON(t):t}};i.element=n,i.el=e(n),i.suggestions=[],i.badQueries=[],i.selectedIndex=-1,i.currentValue=i.element.value,i.intervalId=0,i.cachedResponse=[],i.onChangeInterval=null,i.onChange=null,i.ignoreValueChange=!1,i.isLocal=!1,i.suggestionsContainer=null,i.options=e.extend({},l,s),i.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},i.initialize(),i.setOptions(s)}var n={extend:function(t,n){return e.extend(t,n)},createNode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}},s={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};t.utils=n,e.Autocomplete=t,t.formatResult=function(e,t){var n=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),s="("+t.replace(n,"\\$1")+")";return e.value.replace(new RegExp(s,"gi"),'<strong gtm-element="GTM_Search_Click_result" gtm-label="GTM_Search_Click_result">$1</strong>')},t.prototype={killerFn:null,initialize:function(){var n,s=this,o="."+s.classes.suggestion,i=s.classes.selected,l=s.options;s.element.setAttribute("autocomplete","off"),s.killerFn=function(t){0===e(t.target).closest("."+s.options.containerClass).length&&(s.killSuggestions(),s.disableKillerFn())},l.width&&"auto"!==l.width||(l.width=s.el.outerWidth()),s.suggestionsContainer=t.utils.createNode('<div class="'+l.containerClass+'" style="position: fixed; display: none;"></div>'),(n=e(s.suggestionsContainer)).appendTo(l.appendTo).width(l.width),n.on("mouseover.autocomplete",o,function(){s.activate(e(this).data("index"))}),n.on("mouseout.autocomplete",function(){s.selectedIndex=-1,n.children("."+i).removeClass(i)}),n.on("click.autocomplete",o,function(){s.select(e(this).data("index"),!1)}),s.fixPosition(),window.opera?s.el.on("keypress.autocomplete",function(e){s.onKeyPress(e)}):s.el.on("keydown.autocomplete",function(e){s.onKeyPress(e)}),s.el.on("keyup.autocomplete",function(e){s.onKeyUp(e)}),s.el.on("blur.autocomplete",function(){s.onBlur()}),s.el.on("focus.autocomplete",function(){s.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var s=this,o=s.options,i=0;i=e(".searchBox").width()+20,n.extend(o,t),s.isLocal=e.isArray(o.lookup),s.isLocal&&(o.lookup=s.verifySuggestionsFormat(o.lookup)),e(s.suggestionsContainer).css({"background-color":"#fff",border:"1px solid #ddd",padding:0,"box-sizing":"border-box","border-radius":"0 0 3px 3px","max-height":"370px",overflow:"hidden",width:i+"px","z-index":9999})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue=null,this.suggestions=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t,n=this,s=e("header").height();e(".selectOption").length;if("body"===n.options.appendTo){t=n.el.offset();var o=n.el.outerHeight(),i=Math.ceil(s-o);e(n.suggestionsContainer).css({top:n.el.outerHeight()+i+"px",left:t.left-5+"px"})}},enableKillerFn:function(){var t=this;e(document).on("click.autocomplete",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click.autocomplete",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){var t=this;if(t.disabled||t.visible||e.keyCode!==s.DOWN||!t.currentValue){if(!t.disabled&&t.visible){switch(e.keyCode){case s.ESC:t.el.val(t.currentValue),t.hide();break;case s.TAB:case s.RETURN:if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex,e.keyCode===s.RETURN),e.keyCode===s.TAB&&!1===this.options.tabDisabled)return;break;case s.UP:t.moveUp();break;case s.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else t.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.keyCode){case s.UP:case s.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e,t=this;clearInterval(t.onChangeInterval),t.currentValue=t.element.value,e=t.getQuery(t.currentValue),t.selectedIndex=-1,t.ignoreValueChange?t.ignoreValueChange=!1:e.length<t.options.minChars?t.hide():t.getSuggestions(e)},getQuery:function(t){var n,s=this.options.delimiter;return s?(n=t.split(s),e.trim(n[n.length-1])):e.trim(t)},getSuggestionsLocal:function(t){var n=this,s=t.toLowerCase(),o=n.options.lookupFilter;return{suggestions:e.grep(n.options.lookup,function(e){return o(e,t,s)})}},getSuggestions:function(t){var n,s=this,o=s.options,i=o.serviceUrl;if((n=s.isLocal?s.getSuggestionsLocal(t):s.cachedResponse[t])&&e.isArray(n.suggestions))s.suggestions=n.suggestions,s.suggest();else if(!s.isBadQuery(t)){if(o.params[o.paramName]=t,!1===o.onSearchStart.call(s.element,o.params))return;e.isFunction(o.serviceUrl)&&(i=o.serviceUrl.call(s.element,t)),e.ajax({url:i,data:o.ignoreParams?null:o.params,type:o.type,dataType:o.dataType}).done(function(e){s.processResponse(e,t),o.onSearchComplete.call(s.element,t)})}},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,e(t.suggestionsContainer).hide()},suggest:function(){if(0!==this.suggestions.length){var t=this,n=t.options.formatResult,s=t.getQuery(t.currentValue),o=t.classes.suggestion,i=t.classes.selected,l=e(t.suggestionsContainer),a="",r="";e.each(t.suggestions,function(e,t){switch(t.typeRes){case"doc":r="GTM_Search_Click_result";break;case"tag":r="GTM_Search_Click_keyword";break;default:r="GTM_Search_Click_result"}a+='<div gtm-element="'+r+'" gtm-label="'+r+'" class="'+o+'" data-index="'+e+'">'+n(t,s)+"</div>"}),l.html(a).show(),t.visible=!0,t.options.autoSelectFirst&&(t.selectedIndex=0,l.children().first().addClass(i))}else this.hide()},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},processResponse:function(e,t){var n=this,s=n.options,o=s.transformResult(e,t);o.suggestions=n.verifySuggestionsFormat(o.suggestions),s.noCache||(n.cachedResponse[o[s.paramName]]=o,0===o.suggestions.length&&n.badQueries.push(o[s.paramName])),t===n.getQuery(n.currentValue)&&(n.suggestions=o.suggestions,n.suggest())},activate:function(t){var n,s=this,o=s.classes.selected,i=e(s.suggestionsContainer),l=i.children();return i.children("."+o).removeClass(o),s.selectedIndex=t,-1!==s.selectedIndex&&l.length>s.selectedIndex?(n=l.get(s.selectedIndex),e(n).addClass(o),n):null},select:function(e,t){var n=this,s=n.suggestions[e];s&&(n.el.val(s),n.ignoreValueChange=t,n.hide(),n.onSelect(e))},moveUp:function(){console.log("1");var t=this;if(-1!==t.selectedIndex)return 0===t.selectedIndex?(e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,void t.el.val(t.currentValue)):void t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n,s,o,i=this,l=i.activate(t);if(l){n=l.offsetTop,o=(s=e(i.suggestionsContainer).scrollTop())+i.options.maxHeight-25,n<s?e(i.suggestionsContainer).scrollTop(n):n>o&&e(i.suggestionsContainer).scrollTop(n-i.options.maxHeight+25);var a=i.getValue(i.suggestions[t].value);a=a.replace(/<(?:.|\n)*?>/gm,""),i.el.val(a)}},onSelect:function(t){var n=this,s=n.options.onSelect,o=n.suggestions[t],i=n.getValue(o.value);i=i.replace(/<(?:.|\n)*?>/gm,""),n.el.val(i),e.isFunction(s)&&s.call(n.element,o)},getValue:function(e){e=(e=e.replace(" <b>trong sách số</b>","")).replace(" <b>trong sách nói</b>","");var t,n,s=this,o=s.options.delimiter;return o?(t=s.currentValue,1===(n=t.split(o)).length?e:t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete"),t.disableKillerFn(),e(t.suggestionsContainer).remove()}},e.fn.autocomplete=function(n,s){return 0===arguments.length?this.first().data("autocomplete"):this.each(function(){var o=e(this),i=o.data("autocomplete");"string"==typeof n?i&&"function"==typeof i[n]&&i[n](s):(i&&i.dispose&&i.dispose(),i=new t(this,n),o.data("autocomplete",i))})}});